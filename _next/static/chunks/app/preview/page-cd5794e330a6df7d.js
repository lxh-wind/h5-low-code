(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{24653:(e,s,t)=>{Promise.resolve().then(t.bind(t,99727))},26575:(e,s,t)=>{"use strict";t.d(s,{s:()=>i});var l=t(88693),n=t(46786);let r=()=>"page_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),i=(0,l.vt)()((0,n.Zr)((e,s)=>({pages:[],createPage:(t,l,n)=>{let{pages:i}=s(),a={id:r(),name:t,title:l,description:n,components:[],createdAt:new Date,updatedAt:new Date};return e({pages:[...i,a]}),a},updatePage:(t,l)=>{let{pages:n}=s();e({pages:n.map(e=>e.id===t?{...e,...l,updatedAt:new Date}:e)})},deletePage:t=>{let{pages:l}=s();e({pages:l.filter(e=>e.id!==t)})},getPageById:e=>{let{pages:t}=s();return t.find(s=>s.id===e)||null},duplicatePage:t=>{let{pages:l}=s(),n=l.find(e=>e.id===t);if(!n)return null;let i={...n,id:r(),name:"".concat(n.name," 副本"),title:"".concat(n.title," 副本"),createdAt:new Date,updatedAt:new Date};return e({pages:[...l,i]}),i},generatePageId:r}),{name:"pages-storage",version:1}))},85996:(e,s,t)=>{"use strict";t.d(s,{o:()=>f,M:()=>g});var l=t(95155),n=t(10068),r=t(82502),i=t(61827),a=t(82727),c=t(89613),d=t(93654),o=t(48932),x=t(92657),m=t(4229),h=t(48587),u=t(12115);function g(){let[e,s]=(0,u.useState)(!1),t=(0,i.dj)(),{openPreview:g}=(0,a.bR)(),{canUndo:p,canRedo:f,undo:j,redo:y,precompileStyles:b,currentPage:N}=(0,n.U)(),v=(0,a.g0)(),w=async()=>{try{t.loading("正在准备预览...",1e3),b(),await new Promise(e=>setTimeout(e,800)),g(null==N?void 0:N.id)}catch(e){t.error("预览失败"),console.error("预览失败:",e)}};return(0,l.jsxs)(c.Kq,{children:[(0,l.jsxs)("div",{className:"h-14 bg-white border-b border-gray-200 flex items-center justify-between px-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"H5 Low Code Editor"}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"未命名项目"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(r.sM,{showTooltip:!0}),(0,l.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-2"}),(0,l.jsxs)(c.bL,{children:[(0,l.jsx)(c.l9,{asChild:!0,children:(0,l.jsxs)("button",{onClick:j,disabled:!p(),className:"inline-flex items-center justify-center px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors",children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"撤销"]})}),(0,l.jsx)(c.ZL,{children:(0,l.jsxs)(c.UC,{className:"bg-gray-900 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["撤销 (Ctrl+Z)",(0,l.jsx)(c.i3,{className:"fill-gray-900"})]})})]}),(0,l.jsxs)(c.bL,{children:[(0,l.jsx)(c.l9,{asChild:!0,children:(0,l.jsxs)("button",{onClick:y,disabled:!f(),className:"inline-flex items-center justify-center px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors",children:[(0,l.jsx)(o.A,{className:"h-4 w-4 mr-1"}),"重做"]})}),(0,l.jsx)(c.ZL,{children:(0,l.jsxs)(c.UC,{className:"bg-gray-900 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["重做 (Ctrl+Y)",(0,l.jsx)(c.i3,{className:"fill-gray-900"})]})})]}),(0,l.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-2"}),(0,l.jsxs)(c.bL,{children:[(0,l.jsx)(c.l9,{asChild:!0,children:(0,l.jsxs)("button",{onClick:w,className:"inline-flex items-center justify-center px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:[(0,l.jsx)(x.A,{className:"h-4 w-4 mr-1"}),"预览"]})}),(0,l.jsx)(c.ZL,{children:(0,l.jsxs)(c.UC,{className:"bg-gray-900 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["预览页面",(0,l.jsx)(c.i3,{className:"fill-gray-900"})]})})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)(c.bL,{children:[(0,l.jsx)(c.l9,{asChild:!0,children:(0,l.jsxs)("button",{onClick:()=>{t.success("项目已保存")},className:"inline-flex items-center justify-center px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"保存"]})}),(0,l.jsx)(c.ZL,{children:(0,l.jsxs)(c.UC,{className:"bg-gray-900 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["保存项目",(0,l.jsx)(c.i3,{className:"fill-gray-900"})]})})]}),(0,l.jsxs)(c.bL,{children:[(0,l.jsx)(c.l9,{asChild:!0,children:(0,l.jsxs)("button",{onClick:()=>{try{if(!v)return void t.error("没有可导出的页面");s(!0)}catch(e){t.error("JSON 预览失败"),console.error("JSON 预览失败:",e)}},className:"inline-flex items-center justify-center px-4 py-2 text-sm bg-green-500 hover:bg-green-600 text-white rounded-md transition-colors",children:[(0,l.jsx)(h.A,{className:"h-4 w-4 mr-1"}),"导出"]})}),(0,l.jsx)(c.ZL,{children:(0,l.jsxs)(c.UC,{className:"bg-gray-900 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["预览并导出 JSON Schema",(0,l.jsx)(c.i3,{className:"fill-gray-900"})]})})]})]})]}),(0,l.jsx)(i.zZ,{open:e,onOpenChange:s,page:v,title:"JSON Schema 预览"})]})}var p=t(66766);function f(e){let{component:s,pageConfig:t}=e,{className:n}=s,{type:r,style:i}=s,a={};i&&Object.entries(i).forEach(e=>{let[s,t]=e;t&&(a[s]=t)});let c={};t&&(!a.fontFamily&&t.fontFamily&&(c.fontFamily=t.fontFamily),!a.fontSize&&t.fontSize&&(c.fontSize=t.fontSize),!a.lineHeight&&t.lineHeight&&(c.lineHeight=t.lineHeight),!a.color&&t.color&&(c.color=t.color));let d={...c,...a,boxSizing:"border-box"};switch(r){case"text":return(0,l.jsx)("span",{className:n,style:d,children:s.props.text||"文本内容"});case"button":return(0,l.jsx)("button",{className:"".concat(n," ").concat(n?"":"px-4 py-2 rounded hover:opacity-80 disabled:opacity-50"),style:d,disabled:s.props.disabled,children:s.props.text||"按钮"});case"image":return(0,l.jsx)(p.default,{style:d,src:s.props.src||"https://via.placeholder.com/200x150?text=图片",alt:s.props.alt||"图片",width:200,height:150},s.id);case"input":return(0,l.jsx)("input",{className:"".concat(n," ").concat(n?"":"px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"),style:d,type:s.props.type||"text",placeholder:s.props.placeholder||"请输入内容",readOnly:!0});case"container":return(0,l.jsx)("div",{className:"".concat(n," ").concat(n?"":"min-h-[50px]"),style:d,children:s.children&&s.children.length>0?s.children.map(e=>(0,l.jsx)(f,{component:e,pageConfig:t},e.id)):(0,l.jsx)("div",{className:"text-gray-400 text-sm p-4 text-center",children:"空容器"})});case"list":return(0,l.jsx)("div",{className:n,style:d,children:s.children&&s.children.length>0?s.children.map(e=>(0,l.jsx)(f,{component:e,pageConfig:t},e.id)):(0,l.jsx)("div",{className:"text-gray-400 text-sm p-4 text-center",children:"空列表"})});case"card":return(0,l.jsx)("div",{className:"".concat(n," ").concat(n?"":"bg-white rounded-lg shadow border"),style:d,children:s.children&&s.children.length>0?s.children.map(e=>(0,l.jsx)(f,{component:e,pageConfig:t},e.id)):(0,l.jsx)("div",{className:"text-gray-400 text-sm p-4 text-center",children:"空卡片"})});case"divider":return(0,l.jsx)("div",{className:"".concat(n," ").concat(n?"":"border-t border-gray-300"),style:d});case"space":return(0,l.jsx)("div",{className:n,style:d});default:return(0,l.jsxs)("div",{className:n,style:d,children:["未知组件类型: ",r]})}}},99727:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var l=t(95155),n=t(12115),r=t(35695),i=t(10068),a=t(26575),c=t(85996),d=t(82502);let o=(0,t(19946).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function x(){var e,s,t,x,m,h,u,g,p,f;let j=(0,r.useRouter)(),y=(0,r.useSearchParams)().get("pageId"),[b,N]=(0,n.useState)(!0),[v,w]=(0,n.useState)(null),{components:C,precompileStyles:S}=(0,i.U)(),{getPageById:k}=(0,a.s)();return((0,n.useEffect)(()=>{(async()=>{try{if(N(!0),y){let e=k(y);if(!e)return void j.push("/");w(e)}S(),await new Promise(e=>requestAnimationFrame(e))}catch(e){console.error("预览初始化失败:",e)}finally{N(!1)}})()},[y,S,k,j]),b)?(0,l.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"正在加载预览..."})]})}):(0,l.jsxs)("div",{className:"h-screen flex flex-col bg-gray-100",children:[(0,l.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("button",{onClick:()=>{y?j.push("/editor?pageId=".concat(y)):j.push("/editor")},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,l.jsx)(o,{className:"h-4 w-4 mr-2"}),"返回编辑器"]}),(0,l.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"预览模式"})]}),(0,l.jsx)(d.sM,{showIcon:!0})]}),(0,l.jsx)("div",{className:"flex-1 overflow-auto p-8",children:(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)(d.Mj,{title:(null==v?void 0:v.title)||"H5 页面预览",maxHeight:"calc(100vh - 200px)",children:0===((null==v?void 0:v.components)||C).length?(0,l.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-500",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCF1"}),(0,l.jsx)("p",{className:"text-lg",children:"暂无内容"}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"请返回编辑器添加组件"})]}):(0,l.jsx)("div",{style:{backgroundColor:(null==v||null==(e=v.config)?void 0:e.backgroundColor)||"#ffffff",color:(null==v||null==(s=v.config)?void 0:s.color)||"#333333",fontFamily:(null==v||null==(t=v.config)?void 0:t.fontFamily)||"system-ui, -apple-system, sans-serif",fontSize:(null==v||null==(x=v.config)?void 0:x.fontSize)||"14px",lineHeight:(null==v||null==(m=v.config)?void 0:m.lineHeight)||"1.6",minHeight:(null==v||null==(h=v.config)?void 0:h.minHeight)||"auto",padding:(null==v||null==(u=v.config)?void 0:u.padding)||"16px",maxWidth:(null==v||null==(g=v.config)?void 0:g.maxWidth)||"none",marginLeft:(null==v||null==(p=v.config)?void 0:p.maxWidth)?"auto":"initial",marginRight:(null==v||null==(f=v.config)?void 0:f.maxWidth)?"auto":"initial"},className:"space-y-2",children:((null==v?void 0:v.components)||C).map(e=>(0,l.jsx)(c.o,{component:e,pageConfig:null==v?void 0:v.config},e.id))})})})})]})}function m(){return(0,l.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"正在加载预览..."})]})})}function h(){return(0,l.jsx)(n.Suspense,{fallback:(0,l.jsx)(m,{}),children:(0,l.jsx)(x,{})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[277,861,407,858,999,18,827,502,441,684,358],()=>s(24653)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[639],{3024:function(e,t,n){Promise.resolve().then(n.bind(n,5570))},5570:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(7437),i=n(29),a=n.n(i),s=n(2265),o=n(9311),c=n(6225),l=n.n(c),d=n(1693),u=n(2114),f=n(2020),g=n(1229);function p(){let[e,t]=(0,s.useState)([]),[n,i]=(0,s.useState)(!0),[c,p]=(0,s.useState)(null),{executeComponentEvent:m}=(0,d.e)(),{getPageById:x}=(0,o.u)(),b=(0,s.useMemo)(()=>{if(0===e.length)return"100vh";let t=e.reduce((e,t)=>Math.max(e,(t.style.top||0)+(t.style.height||100)),0);return Math.max(100,parseFloat((0,g.Ok)(t+100).replace("vw","")))+"vw"},[e]);(0,s.useEffect)(()=>{(()=>{let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")})();let e=setTimeout(()=>{try{console.log("开始加载预览数据...");let e=new URLSearchParams(window.location.search).get("pageId");if(!e){console.log("缺少 pageId 参数"),p("缺少页面ID参数，请从首页选择要预览的页面"),i(!1);return}console.log("从页面存储获取数据，pageId:",e);let n=x(e);if(!n){console.log("页面不存在"),p("页面不存在，请检查页面ID是否正确"),i(!1);return}if(!n.components||0===n.components.length){console.log("页面无组件数据"),p("该页面暂无组件内容，请先在编辑器中添加组件"),i(!1);return}let r=JSON.stringify(n.components),a=JSON.parse(r);if(console.log("解析后的组件数据:",a),!Array.isArray(a)||0===a.length){p("没有组件数据，请先在编辑器中添加组件"),i(!1);return}t(a),p(null),console.log("组件数据加载成功，共",a.length,"个组件"),console.log("组件详情:",a)}catch(e){console.error("解析组件数据失败:",e),p("数据解析失败: ".concat(e instanceof Error?e.message:"未知错误"))}finally{i(!1)}},100);return()=>clearTimeout(e)},[]);let h=e=>(0,r.jsx)("div",{className:"absolute",style:{...(0,g.n6)(e.style),zIndex:e.style.zIndex||1},children:(0,r.jsx)(u.x,{component:e,isPreview:!0,children:(0,r.jsx)(f.Z,{component:e,mode:"preview",onEvent:(t,n)=>{n.preventDefault(),n.stopPropagation();let r=e.events||[];m(e.id,t,n,r)}})})},e.id);return n?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"⏳"}),(0,r.jsx)("p",{className:"text-gray-600",children:"正在加载预览..."})]})}):c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsxs)("div",{className:"text-center p-8",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"❌"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:c}),(0,r.jsx)("button",{onClick:()=>window.close(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"关闭预览"})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{className:"jsx-44be7c74667c4f7e",children:"H5预览"})}),(0,r.jsxs)("div",{style:{fontFamily:"system-ui, -apple-system"},className:"jsx-44be7c74667c4f7e min-h-screen bg-white overflow-x-hidden",children:[(0,r.jsx)("div",{className:"jsx-44be7c74667c4f7e fixed top-2 left-2 z-50",children:(0,r.jsx)("button",{onClick:()=>window.close(),style:{width:(0,g.Ok)(32),height:(0,g.Ok)(32),fontSize:(0,g.Ok)(16)},className:"jsx-44be7c74667c4f7e bg-black bg-opacity-50 text-white rounded-full flex items-center justify-center active:scale-95 transition-transform",children:"←"})}),(0,r.jsx)("div",{style:{minHeight:b},className:"jsx-44be7c74667c4f7e w-full relative bg-white",children:0===e.length?(0,r.jsxs)("div",{style:{minHeight:"100vh"},className:"jsx-44be7c74667c4f7e flex flex-col items-center justify-center text-gray-400 p-8",children:[(0,r.jsx)("div",{style:{fontSize:"15vw",marginBottom:"4vw"},className:"jsx-44be7c74667c4f7e",children:"\uD83D\uDCF1"}),(0,r.jsx)("p",{style:{fontSize:"4vw"},className:"jsx-44be7c74667c4f7e",children:"暂无内容"}),(0,r.jsx)("p",{style:{fontSize:"3vw",marginTop:"2vw"},className:"jsx-44be7c74667c4f7e",children:"请在编辑器中添加组件"})]}):e.map(e=>h(e))}),!1]}),(0,r.jsx)(a(),{id:"44be7c74667c4f7e",children:'*{-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}body{margin:0;padding:0;overflow-x:hidden;-webkit-overflow-scrolling:touch;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}input,textarea{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}::-webkit-scrollbar{display:none}@supports(padding:max(0px)){.safe-area-inset-top{padding-top:max(env(safe-area-inset-top),0px)}}'})]})}function m(){return(0,r.jsx)(p,{})}},2869:function(e,t,n){"use strict";n.d(t,{d:function(){return o},z:function(){return c}});var r=n(7437);n(2265);var i=n(7053),a=n(535),s=n(4508);let o=(0,a.j)("cursor-pointer inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:n,size:a,asChild:c=!1,...l}=e,d=c?i.g7:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,s.cn)(o({variant:n,size:a,className:t})),...l})}},6070:function(e,t,n){"use strict";n.d(t,{Ol:function(){return s},Zb:function(){return a},aY:function(){return c},ll:function(){return o}});var r=n(7437);n(2265);var i=n(4508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,i.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,i.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function o(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,i.cn)("leading-none font-semibold",t),...n})}function c(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,i.cn)("px-6",t),...n})}},5186:function(e,t,n){"use strict";n.d(t,{I:function(){return a}});var r=n(7437);n(2265);var i=n(4508);function a(e){let{className:t,type:n,...a}=e;return(0,r.jsx)("input",{type:n,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}},6818:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var r=n(7437);n(2265);var i=n(4508);function a(e){let{className:t,...n}=e;return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...n})}},1693:function(e,t,n){"use strict";n.d(t,{e:function(){return i}});var r=n(2265);function i(){let[e,t]=(0,r.useState)({}),n=(0,r.useRef)(new Map),i=(0,r.useCallback)((e,n)=>{t(t=>({...t,[e]:[...t[e]||[],n]}))},[]),a=(0,r.useCallback)((e,n,r)=>{t(t=>({...t,[e]:(t[e]||[]).map(e=>e.id===n?{...e,...r}:e)}))},[]),s=(0,r.useCallback)((e,n)=>{t(t=>({...t,[e]:(t[e]||[]).filter(e=>e.id!==n)}))},[]),o=(0,r.useCallback)(t=>e[t]||[],[e]),c=(0,r.useCallback)(async(e,t)=>{if(!e.enabled)return;let r=()=>{try{switch(e.type){case"navigate":e.config.url&&(e.config.newTab?window.open(e.config.url,"_blank"):window.location.href=e.config.url);break;case"showModal":e.config.message&&alert(e.config.message);break;case"copyText":e.config.text&&navigator.clipboard&&(navigator.clipboard.writeText(e.config.text),console.log("文本已复制:",e.config.text));break;case"showMessage":if(e.config.message){let t=document.createElement("div");t.textContent=e.config.message,t.style.cssText="\n                position: fixed;\n                top: 20px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: #333;\n                color: white;\n                padding: 12px 24px;\n                border-radius: 6px;\n                z-index: 9999;\n                font-size: 14px;\n              ",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},e.config.duration||3e3)}break;case"executeScript":if(e.config.script)try{Function("context",e.config.script)(t)}catch(e){console.error("脚本执行错误:",e)}break;case"sendRequest":e.config.url&&fetch(e.config.url,{method:e.config.method||"GET",headers:e.config.headers||{},body:e.config.body?JSON.stringify(e.config.body):void 0}).then(e=>e.json()).then(e=>console.log("请求结果:",e)).catch(e=>console.error("请求失败:",e));break;case"toggleElement":if(e.config.targetId){let t=document.getElementById(e.config.targetId);t&&(t.style.display="none"===t.style.display?"":"none")}break;case"playAnimation":if(e.config.animationClass&&e.config.targetId){let t=document.getElementById(e.config.targetId);t&&(t.classList.add(e.config.animationClass),setTimeout(()=>{t.classList.remove(e.config.animationClass)},e.config.duration||1e3))}break;default:console.warn("未知的事件动作类型:",e.type)}}catch(e){console.error("事件动作执行失败:",e)}};if(e.delay&&e.delay>0){let t=setTimeout(r,e.delay);n.current.set(e.id,t)}else r()},[]),l=(0,r.useCallback)((t,n,r,i)=>{let a=(i||e[t]||[]).find(e=>e.type===n&&e.enabled);a&&a.actions.forEach(e=>{c(e,{componentId:t,eventType:n,nativeEvent:r})})},[e,c]);return{componentEvents:e,addEventToComponent:i,updateComponentEvent:a,removeEventFromComponent:s,getComponentEvents:o,executeComponentEvent:l,executeEventAction:c,clearAllTimers:(0,r.useCallback)(()=>{n.current.forEach(e=>clearTimeout(e)),n.current.clear()},[])}}},9311:function(e,t,n){"use strict";n.d(t,{u:function(){return s}});var r=n(9625),i=n(6885);let a=()=>"page_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),s=(0,r.Ue)()((0,i.tJ)((e,t)=>({pages:[],createPage:(n,r,i)=>{let{pages:s}=t(),o={id:a(),name:n,title:r,description:i,components:[],createdAt:new Date,updatedAt:new Date};return e({pages:[...s,o]}),o},updatePage:(n,r)=>{let{pages:i}=t();e({pages:i.map(e=>e.id===n?{...e,...r,updatedAt:new Date}:e)})},deletePage:n=>{let{pages:r}=t();e({pages:r.filter(e=>e.id!==n)})},getPageById:e=>{let{pages:n}=t();return n.find(t=>t.id===e)||null},duplicatePage:n=>{let{pages:r}=t(),i=r.find(e=>e.id===n);if(!i)return null;let s={...i,id:a(),name:"".concat(i.name," 副本"),title:"".concat(i.title," 副本"),createdAt:new Date,updatedAt:new Date};return e({pages:[...r,s]}),s},generatePageId:a}),{name:"pages-storage",version:1}))}},function(e){e.O(0,[518,883,675,508,240,971,117,744],function(){return e(e.s=3024)}),_N_E=e.O()}]);